---
- name: "Install postgres"
  hosts: all
  pre_tasks:
      - name: Add PostgreSQL PGDG GPG key
        ansible.builtin.apt_key:
          url: https://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc
          state: present

      - name: Add PostgreSQL PGDG repository
        ansible.builtin.apt_repository:
          repo: deb http://apt.postgresql.org/pub/repos/apt/ {{ ansible_distribution_release }}-pgdg main
          state: present
          update_cache: yes
          
      - name: Install PostgreSQL server
        ansible.builtin.apt:
          name: postgresql-{{ postgresql_version }} # e.g., postgresql-16
          state: present
        
     # - name: "Install packages"
     #   ansible.builtin.apt:
     #     pkg:
     #      - postgresql
     #      - postgresql-server 
     # - name: "Install Python packages"
     #   pip: "name={{ item }}  state=present"
     #   with_items:
     #     - psycopg2-binary
  
  #tasks:
      #- name: "Find out if PostgreSQL is initialized"
      #  ansible.builtin.stat:
      #    path: "/var/lib/pgsql/data/pg_hba.conf"
      #  register: postgres_data
  
      #- name: "Initialize PostgreSQL"
      #  shell: "postgresql-setup initdb"
      #  when: not postgres_data.stat.exists 
